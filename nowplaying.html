<html>
  <head>
    <script src="/static/MochiKit/MochiKit.js"></script>
    
    <script src="/static/NowPlaying/utils/databean.js"></script>

    <script src="/static/NowPlaying/data/recent_tracks_datasource.js"></script>
    <script src="/static/NowPlaying/data/album_info_datasource.js"></script>
    <script src="/static/NowPlaying/data/now_playing_datasource.js"></script>
    <script src="/static/NowPlaying/data/top_albums_datasource.js"></script>
    <script src="/static/NowPlaying/data/similar_artists_datasource.js"></script>

    <script src="/static/NowPlaying/ui/bar_chart.js"></script>
     
    <script src="/static/NowPlaying/ui/now_playing_panel.js"></script>
    <script src="/static/NowPlaying/ui/top_albums_panel.js"></script>
    <script src="/static/NowPlaying/ui/similar_artists_panel.js"></script>
    
    <script src="/static/MochiKit/MochiKit.js"></script>
    <link rel="stylesheet" href="/static/nowplaying.css"/>
    <script>
      var started = false;
      
      function updateUsername(username){
        if(!started){
          showMain(); 
        }
        $("username").value = username;
        window.location.hash = "#" + username;
  
        var rtData = new RecentTracksDatasource(username);
        var aiData = new AlbumInfoDatasource();
        
        var npData = new NowPlayingDatasource(rtData, aiData);
        
        var taData = new TopAlbumsDatasource();
        npData.connect("artist", function(artist){
          taData.artist = artist;
          taData.update();
        });
        
        var saData = new SimilarArtistsDatasource();
        npData.connect("artist", function(artist){
          saData.artist = artist;
          saData.update();
        });

        rtData.update();
        
        var npUI = new NowPlayingPanel($("now_playing"), npData);        
        var taUI = new TopAlbumsPanel($("top_albums_list"), taData);
        var saUI = new SimilarArtistsPanel($("similar_artists_list"), saData);
      }
      
      function showStart(){
        $('main').style.display = "none";
        $('start').style.display = "block";
      }
      
      function showMain(){
       $('start').style.display = "none";
       $('main').style.display = "block";
      }
      
      window.addEventListener("load", function(){
         if(window.location.hash.length > 1){
            updateUsername(window.location.hash.substring(1));
         }else{
          showStart();
         }
      }, false);
      
    </script> 
  </head>
    <style>
      body{
        margin: 0px;
      }
      input[type='text']{
        padding-left: 0.5em;
      }
      
      #start{
        width: 100%;
        text-align: center;
        padding-top: 10%;
        height: 100%;
        background-color: #3333aa;      
      }
      
      #start label{
        font-family: helvetica;
        font-weight: normal;
        font-size: 24pt;
        padding-right: 0.5em;
        color: #000000;
      }
      
      #start input{
        font-family: tahoma, times, serif;
        font-weight: normal;
        font-size: 24pt;
      }
      
      #start_username{
        padding-left: 0.5em;
        color: #D01F3C;
      }
      #start input.button{
        margin-left: 0.5em;
      }
      
      
    </style>
  <body>
    <div id="start" style="display: none">
       <div class="username_input" >
          <label>last.fm username</label>
          <input type="text" id="start_username"></input>
          <input class="button" type="button" onclick="updateUsername($('start_username').value);" value="Go"></input>  
       </div>
    </div>

  <div id="main" style="display: none">
    
   <div id="username_input" >
      <label>last.fm username</label>
      <input type="text" id="username"></input>
      <input type="button" onclick="updateUsername($('username').value);" value="Go"></input>
   </div>

    <div id="now_playing">
      <h1>Now Playing</h1>
      <div class="now_playing_body">
        <span class="track"></span>
        <span class="by"> - </span>
        <span class="artist"></span>
        <div class="album_body">
          <span class="album_title">From the album</span>
          <span class="album"></span>
        </div>
       </div>
     <br style="clear: both"/>
     </div>

     <div id="artist_info" class="container">   
        <h2><span class="artist">Sonic Youth</span></h2>
        <div class="info">
        <p>Sonic Youth is a seminal alternative rock band from the United States of America, formed in New York City in 1981. Current personnel are founding members Thurston Moore (vocals and guitar), Lee Ranaldo (vocals and guitar), Kim Gordon (bass guitar, guitar and vocals), Mark Ibold (bass guitar), and Steve Shelley (drums).</p>
        </div>
        <div id="top_albums" class="container">
          <h2>Top Albums</h2>
          <ol id="top_albums_list">
          </ol>
        </div>

        <div id="similar_artists" class="container">
          <h2>Similar Artists</h2>
          <ol id="similar_artists_list">
          </ol>
        </div>
        <br style="clear: both"/>
    </div>
    
    <div id="album_info" class="container">
       <h2><span class="album">Daydream Nation</span></h2>
       <img class="album_image" width="130" height="130"></img>
       <div class="track_listing">
           <ol id="track_listing_list">
            <li></li>
            <li></li>
            <li></li>
           </ol>
       </div>
    </div>
  </div> 
 
  </body>
  
</html>
